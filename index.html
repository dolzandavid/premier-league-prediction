<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PL Prediction (Minimal)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, select, button { margin: 5px; }
    table { border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 5px 10px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>Premier League Prediction Game</h1>

  <label>Player:
    <select id="player">
      <option value="">--Select--</option>
      <option value="david">David</option>
      <option value="katja">Katja</option>
      <option value="mark">Mark</option>
      <option value="jus">Jus</option>
    </select>
  </label>

  <label>Game Week:
    <select id="week">
      <option value="">--Select--</option>
      ${Array.from({length:38}, (_,i)=>`<option value="${i+1}">Week ${i+1}</option>`).join('')}
    </select>
  </label>

  <div id="fixturesSection">
    <h2>Fixtures</h2>
    <div id="fixturesList">None yet</div>
    <input id="homeF" placeholder="Home team">
    <input id="awayF" placeholder="Away team">
    <button id="addFix">Add Fixture</button>
  </div>

  <div id="predSection">
    <h2>Predictions</h2>
    <div id="predContent">Select player, week, and add fixtures.</div>
  </div>

  <script>
    const playerEl = document.getElementById('player');
    const weekEl = document.getElementById('week');
    const fixturesList = document.getElementById('fixturesList');
    const addFix = document.getElementById('addFix');
    const homeF = document.getElementById('homeF');
    const awayF = document.getElementById('awayF');
    const predContent = document.getElementById('predContent');

    playerEl.onchange = render;
    weekEl.onchange = render;

    addFix.onclick = () => {
      const w = weekEl.value;
      if (!w) return alert('Select week first');
      const fixtures = JSON.parse(localStorage.getItem(`gw_${w}_fixtures`)) || [];
      fixtures.push({home: homeF.value.trim(), away: awayF.value.trim()});
      localStorage.setItem(`gw_${w}_fixtures`, JSON.stringify(fixtures));
      homeF.value = awayF.value = '';
      render();
    };

    function render() {
      const p = playerEl.value;
      const w = weekEl.value;
      predContent.innerHTML = '';

      if (!p || !w) {
        predContent.textContent = 'Select player and week.';
        fixturesList.textContent = 'None yet';
        return;
      }

      const fixtures = JSON.parse(localStorage.getItem(`gw_${w}_fixtures`)) || [];
      if (fixtures.length === 0) {
        fixturesList.textContent = 'No fixtures added.';
        return;
      } else {
        fixturesList.innerHTML = '<ul>' + fixtures.map(f=>`<li>${f.home} vs ${f.away}</li>`).join('') + '</ul>';
      }

      const key = `gw_${w}_predictions_${p}`;
      const existing = JSON.parse(localStorage.getItem(key));
      if (existing && existing.length === fixtures.length) {
        predContent.innerHTML = '<strong>Your predictions (view-only):</strong><br>' +
          existing.map((ex,i)=>`${fixtures[i].home} ${ex.home}:${ex.away} ${fixtures[i].away}`).join('<br>');
      } else {
        predContent.innerHTML = '<strong>Enter predictions:</strong><br>';
        fixtures.forEach((f,i)=>{
          const h = document.createElement('input');
          const a = document.createElement('input');
          h.type = a.type = 'number';
          h.placeholder = a.placeholder = 'score';
          h.id = 'h'+i; a.id = 'a'+i;
          predContent.append(f.home+' ', h, ' : ', a, ' '+f.away, document.createElement('br'));
        });
        const btn = document.createElement('button');
        btn.textContent = 'Submit';
        btn.onclick = () => {
          const preds = fixtures.map((_,i)=>({
            home: parseInt(document.getElementById('h'+i).value)||0,
            away: parseInt(document.getElementById('a'+i).value)||0
          }));
          localStorage.setItem(key, JSON.stringify(preds));
          render();
        };
        predContent.appendChild(btn);
      }
    }
  </script>
</body>
</html>
