<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Premier League Prediction Game</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6 text-gray-800">
  <div class="max-w-3xl mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-2xl font-bold mb-4">Premier League Prediction Game</h1>

    <div class="grid grid-cols-2 gap-4 mb-6">
      <div>
        <label class="block font-semibold mb-1">Player</label>
        <select id="player" class="w-full border p-2 rounded">
          <option value="">-- Select Player --</option>
          <option value="david">David</option>
          <option value="katja">Katja</option>
          <option value="mark">Mark</option>
          <option value="jus">Jus</option>
        </select>
      </div>
      <div>
        <label class="block font-semibold mb-1">Game Week</label>
        <select id="week" class="w-full border p-2 rounded">
          <option value="">-- Select Week --</option>
          <option value="1">Week 1</option>
          <option value="2">Week 2</option>
          <option value="3">Week 3</option>
          <option value="4">Week 4</option>
          <option value="5">Week 5</option>
          <option value="6">Week 6</option>
          <option value="7">Week 7</option>
          <option value="8">Week 8</option>
          <option value="9">Week 9</option>
          <option value="10">Week 10</option>
          <option value="11">Week 11</option>
          <option value="12">Week 12</option>
          <option value="13">Week 13</option>
          <option value="14">Week 14</option>
          <option value="15">Week 15</option>
          <option value="16">Week 16</option>
          <option value="17">Week 17</option>
          <option value="18">Week 18</option>
          <option value="19">Week 19</option>
          <option value="20">Week 20</option>
          <option value="21">Week 21</option>
          <option value="22">Week 22</option>
          <option value="23">Week 23</option>
          <option value="24">Week 24</option>
          <option value="25">Week 25</option>
          <option value="26">Week 26</option>
          <option value="27">Week 27</option>
          <option value="28">Week 28</option>
          <option value="29">Week 29</option>
          <option value="30">Week 30</option>
          <option value="31">Week 31</option>
          <option value="32">Week 32</option>
          <option value="33">Week 33</option>
          <option value="34">Week 34</option>
          <option value="35">Week 35</option>
          <option value="36">Week 36</option>
          <option value="37">Week 37</option>
          <option value="38">Week 38</option>
        </select>
      </div>
    </div>

    <div class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Add Fixture</h2>
      <div class="flex gap-2 mb-2">
        <input id="homeTeam" placeholder="Home Team" class="flex-1 border p-2 rounded">
        <input id="awayTeam" placeholder="Away Team" class="flex-1 border p-2 rounded">
        <button id="addFixture" class="bg-blue-500 text-white px-4 py-2 rounded">Add</button>
      </div>
      <div id="fixturesDiv" class="text-sm text-gray-600"></div>
    </div>

    <div class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Your Predictions</h2>
      <div id="predictionsDiv"></div>
      <button id="submitPredictions" class="mt-2 bg-green-600 text-white px-4 py-2 rounded">Submit Predictions</button>
    </div>

    <div class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Actual Results</h2>
      <div id="resultsDiv"></div>
      <button id="submitResults" class="mt-2 bg-purple-600 text-white px-4 py-2 rounded">Submit Results</button>
    </div>

    <div class="mb-6">
      <h2 class="text-xl font-semibold mb-2">All Predictions</h2>
      <div id="allPredictionsDiv"></div>
    </div>

    <div class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Leaderboard</h2>
      <div id="leaderboardDiv"></div>
    </div>
  </div>

  <script>
    const players = ["david", "katja", "mark", "jus"];
    const playerEl = document.getElementById("player");
    const weekEl = document.getElementById("week");
    const fixturesDiv = document.getElementById("fixturesDiv");
    const predictionsDiv = document.getElementById("predictionsDiv");
    const resultsDiv = document.getElementById("resultsDiv");
    const allPredictionsDiv = document.getElementById("allPredictionsDiv");
    const leaderboardDiv = document.getElementById("leaderboardDiv");

    let currentPlayer = "";
    let currentWeek = "";

    function safeJSON(key) {
      try { return JSON.parse(localStorage.getItem(key)); } catch { return null; }
    }

    function getFixtures(week) {
      return safeJSON(`gw_${week}_fixtures`) || [];
    }

    function renderFixtures() {
      fixturesDiv.innerHTML = getFixtures(currentWeek)
        .map(f => `<div>${f.home} vs ${f.away}</div>`).join("");
    }

    function renderPredictions() {
      predictionsDiv.innerHTML = "";
      const fixtures = getFixtures(currentWeek);
      const saved = safeJSON(`gw_${currentWeek}_predictions_${currentPlayer}`) || [];

      fixtures.forEach((f, i) => {
        const pred = saved[i] || { home: "", away: "" };
        predictionsDiv.innerHTML += `
          <div class="flex gap-2 items-center mb-2">
            <label class="w-32">${f.home}</label>
            <input id="ph_${i}" type="number" class="w-12 border p-1 rounded" value="${pred.home}"/>
            <span>:</span>
            <input id="pa_${i}" type="number" class="w-12 border p-1 rounded" value="${pred.away}"/>
            <label class="w-32">${f.away}</label>
          </div>`;
      });
    }

    function renderResults() {
      resultsDiv.innerHTML = "";
      const fixtures = getFixtures(currentWeek);
      const saved = safeJSON(`gw_${currentWeek}_results`) || [];

      fixtures.forEach((f, i) => {
        const res = saved[i] || { home: "", away: "" };
        resultsDiv.innerHTML += `
          <div class="flex gap-2 items-center mb-2">
            <label class="w-32">${f.home}</label>
            <input id="rh_${i}" type="number" class="w-12 border p-1 rounded" value="${res.home}"/>
            <span>:</span>
            <input id="ra_${i}" type="number" class="w-12 border p-1 rounded" value="${res.away}"/>
            <label class="w-32">${f.away}</label>
          </div>`;
      });
    }

    function renderAllPredictions() {
      allPredictionsDiv.innerHTML = "";
      const fixtures = getFixtures(currentWeek);
      players.forEach(p => {
        const saved = safeJSON(`gw_${currentWeek}_predictions_${p}`) || [];
        if (!saved.length) return;
        let html = `<h3 class="capitalize font-semibold">${p}</h3>`;
        saved.forEach((s, i) => html += `<div>${fixtures[i].home} ${s.home}:${s.away} ${fixtures[i].away}</div>`);
        allPredictionsDiv.innerHTML += html;
      });
    }

    function updateLeaderboard() {
      leaderboardDiv.innerHTML = "";
      const fixtures = getFixtures(currentWeek);
      const results = safeJSON(`gw_${currentWeek}_results`) || [];
      const scores = {};
      players.forEach(p => { scores[p] = 0; });
      players.forEach(p => {
        const saved = safeJSON(`gw_${currentWeek}_predictions_${p}`) || [];
        saved.forEach((s, i) => {
          const r = results[i];
          if (!r) return;
          if (s.home == r.home) scores[p]++;
          if (s.away == r.away) scores[p]++;
          const po = s.home - s.away;
          const ro = r.home - r.away;
          if ((po > 0 && ro > 0) || (po < 0 && ro < 0) || (po == 0 && ro == 0)) scores[p]+=2;
          if (s.home == r.home && s.away == r.away) scores[p]++;
        });
      });
      for (const p of players) {
        leaderboardDiv.innerHTML += `<div class="capitalize">${p}: ${scores[p]} pts</div>`;
      }
    }

    function handleChange() {
      currentPlayer = playerEl.value;
      currentWeek = weekEl.value;
      if (!currentPlayer || !currentWeek) return;
      renderFixtures();
      renderPredictions();
      renderResults();
      renderAllPredictions();
      updateLeaderboard();
    }

    playerEl.onchange = weekEl.onchange = handleChange;

    document.getElementById("addFixture").onclick = () => {
      if (!currentWeek) return alert("Select week");
      const home = document.getElementById("homeTeam").value.trim();
      const away = document.getElementById("awayTeam").value.trim();
      if (!home||!away) return alert("Enter both teams");
      const fixtures = getFixtures(currentWeek);
      fixtures.push({ home, away });
      localStorage.setItem(`gw_${currentWeek}_fixtures`, JSON.stringify(fixtures));
      renderFixtures();
      renderPredictions();
      renderResults();
    };

    document.getElementById("submitPredictions").onclick = () => {
      const fixtures = getFixtures(currentWeek);
      const preds = fixtures.map((_, i) => ({
        home: document.getElementById(`ph_${i}`).value || "0",
        away: document.getElementById(`pa_${i}`).value || "0"
     
